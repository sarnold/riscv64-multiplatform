From a8e9ad0f98ccfa50b9295cb31b28599f6c1184d3 Mon Sep 17 00:00:00 2001
From: Tom <support@vamrs.com>
Date: Fri, 19 Feb 2021 12:26:59 +0800
Subject: [PATCH 75/86] [CONFIG] Make vic7100 CDNS3 USB host build in kernel.

---
 .../configs/starfive_vic7100_evb_sd_net_fedora_defconfig  | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/arch/riscv/configs/starfive_vic7100_evb_sd_net_fedora_defconfig b/arch/riscv/configs/starfive_vic7100_evb_sd_net_fedora_defconfig
index 1ea249d9974f..f9bc0139c21c 100644
--- a/arch/riscv/configs/starfive_vic7100_evb_sd_net_fedora_defconfig
+++ b/arch/riscv/configs/starfive_vic7100_evb_sd_net_fedora_defconfig
@@ -265,6 +265,7 @@ CONFIG_SOC_STARFIVE_VIC7100=y
 CONFIG_FPGA_GMAC_SPEED_AUTO=y
 CONFIG_FPGA_GMAC_FLUSH_DDR=y
 CONFIG_MMC_DW_FLUSH_DDR=y
+CONFIG_USB_CDNS3_HOST_FLUSH_DMA=y
 # end of StarFive VIC7100 SoC Debug Option
 
 CONFIG_SOC_VIRT=y
@@ -5885,7 +5886,7 @@ CONFIG_USB_XHCI_HCD=y
 CONFIG_USB_XHCI_DBGCAP=y
 CONFIG_USB_XHCI_PCI=m
 CONFIG_USB_XHCI_PCI_RENESAS=m
-CONFIG_USB_XHCI_PLATFORM=m
+CONFIG_USB_XHCI_PLATFORM=y
 CONFIG_USB_EHCI_HCD=y
 CONFIG_USB_EHCI_ROOT_HUB_TT=y
 CONFIG_USB_EHCI_TT_NEWSCHED=y
@@ -5953,7 +5954,8 @@ CONFIG_USBIP_VHCI_HC_PORTS=8
 CONFIG_USBIP_VHCI_NR_HCS=1
 CONFIG_USBIP_HOST=m
 # CONFIG_USBIP_DEBUG is not set
-# CONFIG_USB_CDNS3 is not set
+CONFIG_USB_CDNS3=y
+CONFIG_USB_CDNS3_HOST=y
 # CONFIG_USB_MUSB_HDRC is not set
 # CONFIG_USB_DWC3 is not set
 # CONFIG_USB_DWC2 is not set
@@ -6090,7 +6092,7 @@ CONFIG_TYPEC_DP_ALTMODE=m
 CONFIG_TYPEC_NVIDIA_ALTMODE=m
 # end of USB Type-C Alternate Mode drivers
 
-CONFIG_USB_ROLE_SWITCH=m
+CONFIG_USB_ROLE_SWITCH=y
 CONFIG_MMC=y
 CONFIG_PWRSEQ_EMMC=y
 CONFIG_PWRSEQ_SD8787=m
-- 
2.30.0

